#!/usr/bin/env python
# -*- mode: python -*-

"""Execute data workflows defined in workflow.yaml files
"""

import argparse
import sys
import os
import ConfigParser

from workflow.commands import execute, clean

# setup the option parser
parser = argparse.ArgumentParser(
    description=__doc__,
)

# can only specify one of --force or --dry-run
parser.add_argument(
    '-f', '--force',
    action="store_true",
    help=(
        "Rerun entire workflow, regardless of task state. With --clean, "
        "remove all `creates` targets in workflow without confirmation."
    ),
)
parser.add_argument(
    '-d', '--dry-run',
    action="store_true",
    help=(
        "Do not run workflow, just report which tasks woulc be run and how "
        "long it would take."
    ),
)
parser.add_argument(
    '-e', '--export',
    action="store_true",
    help="Export shell script instead of running the workflow.",
)

# can only specify one of --clean or --force-clean
parser.add_argument(
    '-c', '--clean',
    action="store_true",
    help="Confirm before removing all `creates` targets defined in workflow.",
)

# parse arguemnts and run it
args = parser.parse_args()
if args.clean:
    clean(force=args.force)
else:
    execute(force=args.force, dry_run=args.dry_run, export=args.export)
